{% extends "container/public.html" %}

{% block content %}
<p>Welcome, {{ client.get_name() }}.</p>
<p>You registered on {{ profile.created_at }}.</p>

<h2>Avatar</h2>

<div class="avatar-section">
    {% match profile.avatar_filename %}
    {% when Some with (filename) %}
    <div class="current-avatar" style="margin-bottom: 15px;">
        <p>Current avatar:</p>
        {{ profile.get_avatar_html(crate::attachment::AttachmentSize::L)|safe }}
    </div>
    {% when None %}
    <p>You don't have an avatar yet.</p>
    {% endmatch %}

    <form action="/account/avatar" method="post" enctype="multipart/form-data" style="display: inline-block; margin-right: 10px;">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">
        <input type="file" name="avatar" required />
        <button type="submit">Upload Avatar</button>
    </form>

    {% match profile.avatar_filename %}
    {% when Some with (filename) %}
    <form action="/account/avatar/delete" method="post" style="display: inline-block;">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">
        <button type="submit" onclick="return confirm('Are you sure you want to delete your avatar?');">Delete Avatar</button>
    </form>
    {% when None %}
    {% endmatch %}
</div>

<h2>Preferences</h2>

<div class="preferences-section">
    <form action="/account/preferences" method="post">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">

        <div class="preference-item">
            <label for="posts_per_page">Posts per page:</label>
            <select name="posts_per_page" id="posts_per_page">
                <option value="10" {% if profile.posts_per_page == 10 %}selected{% endif %}>10</option>
                <option value="25" {% if profile.posts_per_page == 25 %}selected{% endif %}>25 (default)</option>
                <option value="50" {% if profile.posts_per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if profile.posts_per_page == 100 %}selected{% endif %}>100</option>
            </select>
            <p class="help-text">Control how many posts are displayed per page in threads.</p>
        </div>

        <div class="preference-item">
            <label for="theme">Theme:</label>
            <select name="theme" id="theme">
                <option value="light" {% if profile.theme == "light" %}selected{% endif %}>‚òÄÔ∏è Light</option>
                <option value="dark" {% if profile.theme == "dark" %}selected{% endif %}>üåô Dark</option>
                <option value="auto" {% if profile.theme == "auto" %}selected{% endif %}>üîÑ Auto (follow system)</option>
            </select>
            <p class="help-text">Choose your preferred color theme for the forum.</p>
        </div>

        <button type="submit">Save Preferences</button>
    </form>
</div>

<style>
    .preferences-section {
        margin-top: 30px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 4px;
    }

    .preference-item {
        margin-bottom: 20px;
    }

    .preference-item label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .preference-item select {
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-width: 200px;
    }

    .help-text {
        margin-top: 5px;
        font-size: 0.9em;
        color: #666;
    }

    .profile-section {
        margin-top: 30px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 4px;
    }

    .profile-item {
        margin-bottom: 20px;
    }

    .profile-item label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .profile-item input,
    .profile-item textarea {
        width: 100%;
        max-width: 500px;
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: inherit;
    }

    .profile-item textarea {
        resize: vertical;
    }
</style>

<h2>Profile</h2>

<div class="profile-section">
    <form action="/account/profile" method="post">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">

        <div class="profile-item">
            <label for="bio">About Me:</label>
            <textarea name="bio" id="bio" rows="6" maxlength="2000" placeholder="Tell others about yourself...">{% match profile.bio %}{% when Some with (bio) %}{{ bio }}{% when None %}{% endmatch %}</textarea>
            <p class="help-text">Up to 2000 characters. Displayed on your public profile.</p>
        </div>

        <div class="profile-item">
            <label for="location">Location:</label>
            <input type="text" name="location" id="location" maxlength="255" value="{% match profile.location %}{% when Some with (loc) %}{{ loc }}{% when None %}{% endmatch %}" placeholder="City, Country">
            <p class="help-text">Your geographic location (optional).</p>
        </div>

        <div class="profile-item">
            <label for="website_url">Website:</label>
            <input type="url" name="website_url" id="website_url" maxlength="2048" value="{% match profile.website_url %}{% when Some with (url) %}{{ url }}{% when None %}{% endmatch %}" placeholder="https://example.com">
            <p class="help-text">Your personal website (must start with http:// or https://).</p>
        </div>

        <div class="profile-item">
            <label for="signature">Signature:</label>
            <textarea name="signature" id="signature" rows="3" maxlength="500" placeholder="Your signature appears below your posts">{% match profile.signature %}{% when Some with (sig) %}{{ sig }}{% when None %}{% endmatch %}</textarea>
            <p class="help-text">Up to 500 characters. Supports BBCode formatting.</p>
        </div>

        <button type="submit">Save Profile</button>
    </form>
</div>

{% endblock %}
