{% extends "container/public.html" %}

{% block content %}
<p>Welcome, {{ client.get_name() }}.</p>
<p>You registered on {{ profile.created_at }}.</p>

<h2>Avatar</h2>

<div class="avatar-section">
    {% match profile.avatar_filename %}
    {% when Some with (filename) %}
    <div class="current-avatar" style="margin-bottom: 15px;">
        <p>Current avatar:</p>
        {{ profile.get_avatar_html(crate::attachment::AttachmentSize::L)|safe }}
    </div>
    {% when None %}
    <p>You don't have an avatar yet.</p>
    {% endmatch %}

    <form action="/account/avatar" method="post" enctype="multipart/form-data" style="display: inline-block; margin-right: 10px;">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">
        <input type="file" name="avatar" required />
        <button type="submit">Upload Avatar</button>
    </form>

    {% match profile.avatar_filename %}
    {% when Some with (filename) %}
    <form action="/account/avatar/delete" method="post" style="display: inline-block;">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">
        <button type="submit" onclick="return confirm('Are you sure you want to delete your avatar?');">Delete Avatar</button>
    </form>
    {% when None %}
    {% endmatch %}
</div>

<h2>Preferences</h2>

<div class="preferences-section">
    <form action="/account/preferences" method="post">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">

        <div class="preference-item">
            <label for="posts_per_page">Posts per page:</label>
            <select name="posts_per_page" id="posts_per_page">
                <option value="10" {% if profile.posts_per_page == 10 %}selected{% endif %}>10</option>
                <option value="25" {% if profile.posts_per_page == 25 %}selected{% endif %}>25 (default)</option>
                <option value="50" {% if profile.posts_per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if profile.posts_per_page == 100 %}selected{% endif %}>100</option>
            </select>
            <p class="help-text">Control how many posts are displayed per page in threads.</p>
        </div>

        <button type="submit">Save Preferences</button>
    </form>
</div>

<style>
    .preferences-section {
        margin-top: 30px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 4px;
    }

    .preference-item {
        margin-bottom: 20px;
    }

    .preference-item label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .preference-item select {
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-width: 200px;
    }

    .help-text {
        margin-top: 5px;
        font-size: 0.9em;
        color: #666;
    }
</style>

{% endblock %}
