{% extends "container/public.html" %}

{% block title %}{% if room.is_some() %}Edit{% else %}Add{% endif %} Chat Room - Admin{% endblock %}

{% block content %}
<div class="admin-panel">
    <div class="panel-header">
        <h1>{% if room.is_some() %}Edit{% else %}Add{% endif %} Chat Room</h1>
        <p class="panel-subtitle">{% if room.is_some() %}Modify chat room settings{% else %}Create a new chat room{% endif %}</p>
    </div>

    {% if let Some(err) = error %}
    <div class="alert alert-danger">{{ err }}</div>
    {% endif %}

    <form action="{% if let Some(r) = room %}/admin/chat-rooms/{{ r.id }}{% else %}/admin/chat-rooms{% endif %}" method="post" class="room-form">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}" />

        <div class="form-section">
            <h3>Room Details</h3>

            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title"
                       value="{% if let Some(r) = room %}{{ r.title }}{% endif %}"
                       placeholder="e.g., General, Staff Lounge" required />
                <small class="form-help">The display name for this chat room.</small>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <input type="text" id="description" name="description"
                       value="{% if let Some(r) = room %}{% match r.description %}{% when Some with (d) %}{{ d }}{% when None %}{% endmatch %}{% endif %}"
                       placeholder="e.g., General discussion for all users" />
                <small class="form-help">Brief description shown in room list.</small>
            </div>

            <div class="form-group">
                <label for="display_order">Display Order</label>
                <input type="number" id="display_order" name="display_order"
                       value="{% if let Some(r) = room %}{{ r.display_order }}{% else %}0{% endif %}" />
                <small class="form-help">Lower numbers appear first in the room list.</small>
            </div>
        </div>

        <div class="form-section">
            <h3>Access Restrictions</h3>
            <p class="section-help">Set requirements that users must meet to access this room. Leave at 0 to disable a restriction.</p>

            <div class="form-row">
                <div class="form-group">
                    <label for="min_posts_required">Minimum Posts</label>
                    <input type="number" id="min_posts_required" name="min_posts_required" min="0"
                           value="{% if let Some(r) = room %}{{ r.min_posts_required }}{% else %}0{% endif %}" />
                    <small class="form-help">Minimum approved posts required (0 = no restriction).</small>
                </div>

                <div class="form-group">
                    <label for="min_account_age_hours">Minimum Account Age (hours)</label>
                    <input type="number" id="min_account_age_hours" name="min_account_age_hours" min="0"
                           value="{% if let Some(r) = room %}{{ r.min_account_age_hours }}{% else %}0{% endif %}" />
                    <small class="form-help">Minimum account age in hours (0 = no restriction).</small>
                </div>
            </div>

            {% if let Some(r) = room %}
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_staff_only" id="is_staff_only"
                           {% if r.is_staff_only %}checked{% endif %} />
                    Staff Only
                </label>
                <small class="form-help">Only moderators and administrators can access this room.</small>
            </div>
            {% else %}
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_staff_only" id="is_staff_only" />
                    Staff Only
                </label>
                <small class="form-help">Only moderators and administrators can access this room.</small>
            </div>
            {% endif %}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% if room.is_some() %}Update{% else %}Create{% endif %} Room</button>
            <a href="/admin/chat-rooms" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
.admin-panel {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
}

.panel-header {
    margin-bottom: 30px;
}

.panel-header h1 {
    margin: 0 0 10px 0;
    color: #333;
}

.panel-subtitle {
    margin: 0;
    color: #666;
}

.alert {
    padding: 12px 16px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.room-form {
    background: #fff;
    padding: 25px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.form-section {
    margin: 25px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 6px;
}

.form-section:first-of-type {
    margin-top: 0;
}

.form-section h3 {
    margin: 0 0 15px 0;
    font-size: 1em;
    color: #333;
}

.section-help {
    margin: -10px 0 15px 0;
    color: #666;
    font-size: 0.9em;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #333;
}

.form-group input[type="text"],
.form-group input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
}

.form-help {
    display: block;
    margin-top: 5px;
    color: #666;
    font-size: 0.85em;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: normal;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 25px;
}

.btn {
    display: inline-block;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    text-decoration: none;
}

.btn-primary {
    background: #007bff;
    color: #fff;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-secondary {
    background: #6c757d;
    color: #fff;
}

.btn-secondary:hover {
    background: #5a6268;
}

/* Dark mode support */
html.dark .admin-panel h1,
html.dark .form-section h3 {
    color: #fff;
}

html.dark .panel-subtitle,
html.dark .form-help,
html.dark .section-help {
    color: #aaa;
}

html.dark .room-form {
    background: #2a2a2a;
    border-color: #444;
}

html.dark .form-section {
    background: #333;
}

html.dark .form-group label {
    color: #fff;
}

html.dark .form-group input {
    background: #3a3a3a;
    border-color: #555;
    color: #fff;
}

html.dark .alert-danger {
    background: #3a2a2a;
    color: #ff6b6b;
    border-color: #5a3a3a;
}
</style>
{% endblock %}
