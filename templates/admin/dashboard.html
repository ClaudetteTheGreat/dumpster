{% extends "container/public.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="admin-panel admin-dashboard">
    <div class="panel-header">
        <h1>Admin Dashboard</h1>
        <p class="panel-subtitle">Site overview and quick actions</p>
    </div>

    <!-- Quick Links -->
    <div class="quick-links">
        {% if client.can("admin.user.ban") %}
        <a href="/admin/bans" class="quick-link">
            <span class="link-icon">&#128683;</span>
            <span class="link-text">User Bans</span>
            {% if stats.active_bans > 0 %}
            <span class="badge badge-warning">{{ stats.active_bans }}</span>
            {% endif %}
        </a>
        <a href="/admin/ip-bans" class="quick-link">
            <span class="link-icon">&#127760;</span>
            <span class="link-text">IP Bans</span>
            {% if stats.active_ip_bans > 0 %}
            <span class="badge badge-warning">{{ stats.active_ip_bans }}</span>
            {% endif %}
        </a>
        {% endif %}
        {% if client.can("moderate.reports.view") %}
        <a href="/admin/reports" class="quick-link">
            <span class="link-icon">&#128680;</span>
            <span class="link-text">Reports</span>
            {% if stats.open_reports > 0 %}
            <span class="badge badge-danger">{{ stats.open_reports }}</span>
            {% endif %}
        </a>
        {% endif %}
        {% if client.can("admin.word_filters.view") %}
        <a href="/admin/word-filters" class="quick-link">
            <span class="link-icon">&#128221;</span>
            <span class="link-text">Word Filters</span>
            <span class="badge badge-info">{{ stats.word_filters }}</span>
        </a>
        {% endif %}
        {% if client.can("admin.settings") %}
        <a href="/admin/settings" class="quick-link">
            <span class="link-icon">&#9881;</span>
            <span class="link-text">Settings</span>
        </a>
        <a href="/admin/feature-flags" class="quick-link">
            <span class="link-icon">&#127987;</span>
            <span class="link-text">Feature Flags</span>
        </a>
        <a href="/admin/reaction-types" class="quick-link">
            <span class="link-icon">&#128077;</span>
            <span class="link-text">Reactions</span>
        </a>
        <a href="/admin/forums" class="quick-link">
            <span class="link-icon">&#128193;</span>
            <span class="link-text">Forums</span>
        </a>
        <a href="/admin/tags" class="quick-link">
            <span class="link-icon">&#127991;</span>
            <span class="link-text">Tags</span>
        </a>
        {% endif %}
        {% if client.can("admin.user.manage") %}
        <a href="/admin/users" class="quick-link">
            <span class="link-icon">&#128100;</span>
            <span class="link-text">Users</span>
            <span class="badge badge-info">{{ stats.total_users }}</span>
        </a>
        {% endif %}
        {% if client.can("moderate.approval.view") %}
        <a href="/admin/approval-queue" class="quick-link">
            <span class="link-icon">&#128203;</span>
            <span class="link-text">User Approval</span>
            {% if stats.pending_users > 0 %}
            <span class="badge badge-warning">{{ stats.pending_users }}</span>
            {% endif %}
        </a>
        <a href="/admin/post-approval-queue" class="quick-link">
            <span class="link-icon">&#128221;</span>
            <span class="link-text">Post Approval</span>
            {% if stats.pending_posts > 0 %}
            <span class="badge badge-warning">{{ stats.pending_posts }}</span>
            {% endif %}
        </a>
        {% endif %}
        {% if client.can("admin.permissions.manage") %}
        <a href="/admin/groups" class="quick-link">
            <span class="link-icon">&#128101;</span>
            <span class="link-text">Groups</span>
        </a>
        {% endif %}
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_users }}</div>
            <div class="stat-label">Total Users</div>
            {% if stats.new_users_today > 0 %}
            <div class="stat-change positive">+{{ stats.new_users_today }} today</div>
            {% endif %}
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_threads }}</div>
            <div class="stat-label">Total Threads</div>
            {% if stats.new_threads_today > 0 %}
            <div class="stat-change positive">+{{ stats.new_threads_today }} today</div>
            {% endif %}
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_posts }}</div>
            <div class="stat-label">Total Posts</div>
            {% if stats.new_posts_today > 0 %}
            <div class="stat-change positive">+{{ stats.new_posts_today }} today</div>
            {% endif %}
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_forums }}</div>
            <div class="stat-label">Forums</div>
        </div>
    </div>

    <div class="dashboard-grid">
        {% if client.can("admin.user.manage") %}
        <!-- Recent Users -->
        <div class="dashboard-section">
            <h2>Recent Users</h2>
            {% if recent_users.is_empty() %}
            <p class="empty-text">No recent users</p>
            {% else %}
            <ul class="activity-list">
                {% for user in recent_users %}
                <li class="activity-item">
                    <a href="/members/{{ user.id }}" class="user-link">{{ user.username }}</a>
                    <span class="activity-time">{{ user.created_at.format("%b %d, %H:%M") }}</span>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endif %}

        <!-- Recent Moderation Actions -->
        <div class="dashboard-section">
            <h2>Recent Moderation</h2>
            {% if recent_mod_actions.is_empty() %}
            <p class="empty-text">No recent moderation actions</p>
            {% else %}
            <ul class="activity-list">
                {% for action in recent_mod_actions %}
                <li class="activity-item">
                    <span class="mod-action">{{ action.action }}</span>
                    <span class="mod-target">{{ action.target_type }} #{{ action.target_id }}</span>
                    <span class="activity-time">{{ action.created_at.format("%b %d, %H:%M") }}</span>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        {% if client.can("moderate.reports.view") %}
        <!-- Open Reports -->
        <div class="dashboard-section">
            <h2>Open Reports</h2>
            {% if open_reports.is_empty() %}
            <p class="empty-text">No open reports</p>
            {% else %}
            <ul class="activity-list">
                {% for report in open_reports %}
                <li class="activity-item">
                    <a href="/admin/reports/{{ report.id }}" class="report-link">
                        {{ report.content_type }} report
                    </a>
                    <span class="report-reason">{{ report.reason }}</span>
                    <span class="activity-time">{{ report.created_at.format("%b %d, %H:%M") }}</span>
                </li>
                {% endfor %}
            </ul>
            <a href="/admin/reports" class="view-all-link">View all reports &rarr;</a>
            {% endif %}
        </div>
        {% endif %}

        {% if client.can("admin.settings") %}
        <!-- System Info -->
        <div class="dashboard-section">
            <h2>System Info</h2>
            <dl class="info-list">
                <dt>Active Sessions</dt>
                <dd>{{ stats.active_sessions }}</dd>
                <dt>Database Size</dt>
                <dd>{{ stats.db_size }}</dd>
                <dt>Server Time</dt>
                <dd>{{ server_time }}</dd>
            </dl>
        </div>
        {% endif %}
    </div>
</div>

<style>
.admin-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.panel-header {
    margin-bottom: 30px;
}

.panel-header h1 {
    margin: 0 0 10px 0;
    color: #333;
}

.panel-subtitle {
    margin: 0;
    color: #666;
}

/* Quick Links */
.quick-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.quick-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 15px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s;
    position: relative;
}

.quick-link:hover {
    border-color: #4a90d9;
    box-shadow: 0 2px 8px rgba(74, 144, 217, 0.2);
    transform: translateY(-2px);
}

.link-icon {
    font-size: 2em;
    margin-bottom: 8px;
}

.link-text {
    color: #333;
    font-weight: 500;
    font-size: 0.9em;
}

.quick-link .badge {
    position: absolute;
    top: 10px;
    right: 10px;
}

/* Statistics Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, #4a90d9 0%, #357abd 100%);
    color: #fff;
    padding: 25px;
    border-radius: 10px;
    text-align: center;
}

.stat-value {
    font-size: 2.5em;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9em;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-change {
    font-size: 0.8em;
    margin-top: 8px;
    padding: 3px 8px;
    border-radius: 10px;
    display: inline-block;
}

.stat-change.positive {
    background: rgba(255, 255, 255, 0.2);
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.dashboard-section {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
}

.dashboard-section h2 {
    font-size: 1.1em;
    color: #333;
    margin: 0 0 15px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #eee;
}

.empty-text {
    color: #999;
    font-style: italic;
    text-align: center;
    padding: 20px;
}

/* Activity List */
.activity-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

.activity-item {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
}

.activity-item:last-child {
    border-bottom: none;
}

.user-link, .report-link {
    color: #4a90d9;
    text-decoration: none;
    font-weight: 500;
}

.user-link:hover, .report-link:hover {
    text-decoration: underline;
}

.activity-time {
    color: #999;
    font-size: 0.85em;
    margin-left: auto;
}

.mod-action {
    background: #e9ecef;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 500;
}

.mod-target {
    color: #666;
    font-size: 0.9em;
}

.report-reason {
    color: #666;
    font-size: 0.85em;
    flex-basis: 100%;
    padding-left: 0;
}

.view-all-link {
    display: block;
    text-align: center;
    margin-top: 15px;
    color: #4a90d9;
    text-decoration: none;
    font-size: 0.9em;
}

.view-all-link:hover {
    text-decoration: underline;
}

/* Info List */
.info-list {
    margin: 0;
}

.info-list dt {
    color: #666;
    font-size: 0.85em;
    margin-top: 10px;
}

.info-list dt:first-child {
    margin-top: 0;
}

.info-list dd {
    margin: 3px 0 0 0;
    font-weight: 500;
    color: #333;
}

/* Badges */
.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.75em;
    font-weight: 600;
}

.badge-danger {
    background: #dc3545;
    color: #fff;
}

.badge-warning {
    background: #ffc107;
    color: #000;
}

.badge-info {
    background: #17a2b8;
    color: #fff;
}

/* Dark Mode */
html.dark .panel-header h1,
html.dark .dashboard-section h2,
html.dark .link-text,
html.dark .info-list dd {
    color: #fff;
}

html.dark .panel-subtitle,
html.dark .info-list dt {
    color: #aaa;
}

html.dark .quick-link {
    background: #2a2a2a;
    border-color: #444;
}

html.dark .quick-link:hover {
    border-color: #4a90d9;
}

html.dark .dashboard-section {
    background: #2a2a2a;
    border-color: #444;
}

html.dark .dashboard-section h2 {
    border-color: #444;
}

html.dark .activity-item {
    border-color: #444;
}

html.dark .mod-action {
    background: #444;
    color: #fff;
}

html.dark .mod-target,
html.dark .report-reason {
    color: #aaa;
}

/* Responsive */
@media (max-width: 768px) {
    .quick-links {
        grid-template-columns: repeat(3, 1fr);
    }

    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .quick-links {
        grid-template-columns: repeat(2, 1fr);
    }

    .stat-value {
        font-size: 2em;
    }
}
</style>
{% endblock %}
