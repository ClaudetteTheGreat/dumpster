{% extends "container/public.html" %}

{% block title %}{% if theme.is_some() %}Edit{% else %}Create{% endif %} Theme - Admin{% endblock %}

{% block content %}
<div class="admin-panel">
    <div class="panel-header">
        <h1>{% if theme.is_some() %}Edit{% else %}Create{% endif %} Theme</h1>
    </div>

    {% if let Some(err) = error %}
    <div class="alert alert-error">{{ err }}</div>
    {% endif %}

    <form action="{% if let Some(t) = theme %}/admin/themes/{{ t.id }}{% else %}/admin/themes{% endif %}"
          method="post" class="theme-form">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}" />

        <div class="form-group">
            <label for="name">Theme Name *</label>
            <input type="text" id="name" name="name" required maxlength="100"
                   value="{% if let Some(t) = theme %}{{ t.name }}{% endif %}"
                   placeholder="My Custom Theme" />
        </div>

        <div class="form-group">
            <label for="slug">Slug (URL-safe identifier) *</label>
            <input type="text" id="slug" name="slug" required pattern="[a-z0-9-]+" maxlength="50"
                   value="{% if let Some(t) = theme %}{{ t.slug }}{% endif %}"
                   placeholder="my-custom-theme"
                   {% if let Some(t) = theme %}{% if t.is_system %}readonly{% endif %}{% endif %} />
            <small>Lowercase letters, numbers, and hyphens only</small>
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="2" maxlength="500"
                      placeholder="A brief description of this theme">{% if let Some(t) = theme %}{{ t.description.as_deref().unwrap_or("") }}{% endif %}</textarea>
        </div>

        <div class="form-row">
            <div class="form-group form-group--checkbox">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_dark"
                           {% if let Some(t) = theme %}{% if t.is_dark %}checked{% endif %}{% endif %} />
                    Dark Theme
                </label>
                <small>Enable dark mode CSS class when this theme is active</small>
            </div>

            <div class="form-group form-group--checkbox">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_active"
                           {% if let Some(t) = theme %}{% if t.is_active %}checked{% endif %}{% else %}checked{% endif %} />
                    Active
                </label>
                <small>Users can select this theme</small>
            </div>
        </div>

        <div class="form-group">
            <label for="display_order">Display Order</label>
            <input type="number" id="display_order" name="display_order" min="0" max="999"
                   value="{% if let Some(t) = theme %}{{ t.display_order }}{% else %}10{% endif %}" />
            <small>Lower numbers appear first in the theme selector</small>
        </div>

        <div class="form-group">
            <label for="parent_id">Parent Theme</label>
            <select id="parent_id" name="parent_id">
                <option value="">None (standalone theme)</option>
                {% for parent in available_parents %}
                <option value="{{ parent.id }}"
                    {% if let Some(t) = theme %}{% if t.has_parent_id(parent.id) %}selected{% endif %}{% endif %}>
                    {{ parent.name }}{% if parent.is_dark %} (Dark){% endif %}
                </option>
                {% endfor %}
            </select>
            <small>Child themes inherit CSS from their parent. Parent CSS is applied first, then this theme's CSS overrides it.</small>
        </div>

        <div class="form-section">
            <h3>CSS Variable Overrides</h3>
            <p class="form-help">Override CSS custom properties. Format: <code>--variable-name: value;</code></p>
            <textarea id="css_variables" name="css_variables" rows="12" class="code-editor"
                      placeholder="--background-color: #000000;
--text-color: #ffffff;
--border-color: #333333;">{% if let Some(t) = theme %}{{ t.css_variables.as_deref().unwrap_or("") }}{% endif %}</textarea>
            <details class="variable-reference">
                <summary>Available Variables Reference</summary>
                <pre>
/* Backgrounds */
--background-color          /* Main page background */
--bg-primary                /* Primary background */
--bg-secondary              /* Secondary background */
--bg-tertiary               /* Tertiary background */
--bg-hover                  /* Hover state background */
--bg-header                 /* Header background */
--bg-code                   /* Code block background */
--bg-modal                  /* Modal background */
--bg-input                  /* Input field background */

/* Text */
--text-color                /* Main text color */
--text-primary              /* Primary text */
--text-secondary            /* Secondary text */
--text-muted                /* Muted/subtle text */

/* Borders */
--border-color              /* Main border color */
--border-primary            /* Primary borders */
--border-secondary          /* Secondary borders */

/* Navigation */
--nav-background            /* Navigation bar background */
--nav-text                  /* Navigation text color */
--nav-hover-background      /* Nav hover state */

/* Components */
--btn-secondary-bg          /* Secondary button background */
--btn-secondary-border      /* Secondary button border */
--btn-secondary-text        /* Secondary button text */
--code-bg                   /* Code block background */
--code-border               /* Code block border */
--table-header-bg           /* Table header background */
--table-border              /* Table border */
--reaction-bg               /* Reaction badge background */
--mq-indicator-bg           /* Multi-quote indicator */
                </pre>
            </details>
        </div>

        <div class="form-section">
            <h3>Custom CSS</h3>
            <p class="form-help">Additional CSS rules applied after base styles. Use for layout changes, fonts, etc.</p>
            <textarea id="css_custom" name="css_custom" rows="15" class="code-editor"
                      placeholder="/* Custom CSS rules */
body {
    font-family: 'Custom Font', sans-serif;
}">{% if let Some(t) = theme %}{{ t.css_custom.as_deref().unwrap_or("") }}{% endif %}</textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if theme.is_some() %}Update{% else %}Create{% endif %} Theme
            </button>
            <a href="/admin/themes" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
.admin-panel {
    max-width: 900px;
}
.panel-header {
    margin-bottom: 20px;
}
.panel-header h1 {
    margin: 0;
}
.alert {
    padding: 12px 16px;
    border-radius: 4px;
    margin-bottom: 20px;
}
.alert-error {
    background: #fdecea;
    color: #c0392b;
    border: 1px solid #e74c3c;
}
.theme-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}
.form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.form-group label {
    font-weight: 600;
    color: var(--text-color);
}
.form-group input[type="text"],
.form-group input[type="number"],
.form-group textarea,
.form-group select {
    padding: 10px 12px;
    border: 1px solid var(--border-color, #ccc);
    border-radius: 4px;
    background: var(--input-background, #fff);
    color: var(--text-color);
    font-size: 14px;
}
.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}
.form-group input[readonly] {
    background: var(--bg-tertiary, #f0f0f0);
    cursor: not-allowed;
}
.form-group small {
    color: var(--text-muted, #666);
    font-size: 12px;
}
.form-row {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
}
.form-group--checkbox {
    flex-direction: row;
    align-items: flex-start;
    gap: 8px;
}
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: normal;
}
.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}
.form-section {
    border: 1px solid var(--border-color, #ddd);
    border-radius: 8px;
    padding: 20px;
    background: var(--bg-secondary, #fafafa);
}
.form-section h3 {
    margin: 0 0 8px 0;
    font-size: 16px;
}
.form-help {
    color: var(--text-muted, #666);
    font-size: 13px;
    margin: 0 0 12px 0;
}
.form-help code {
    background: var(--inline-code-bg, #f0f0f0);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
}
.code-editor {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.5;
    tab-size: 4;
}
.variable-reference {
    margin-top: 12px;
}
.variable-reference summary {
    cursor: pointer;
    color: #3498db;
    font-size: 13px;
}
.variable-reference pre {
    margin: 12px 0 0 0;
    padding: 16px;
    background: var(--code-bg, #f6f8fa);
    border: 1px solid var(--code-border, #ddd);
    border-radius: 4px;
    font-size: 12px;
    line-height: 1.6;
    overflow-x: auto;
}
.form-actions {
    display: flex;
    gap: 12px;
    padding-top: 10px;
    border-top: 1px solid var(--border-color, #ddd);
}
.btn {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 4px;
    text-decoration: none;
    cursor: pointer;
    border: 1px solid transparent;
    font-size: 14px;
    font-weight: 500;
}
.btn-primary {
    background: #3498db;
    color: white;
}
.btn-primary:hover {
    background: #2980b9;
}
.btn-secondary {
    background: var(--btn-secondary-bg, #f0f0f0);
    color: var(--btn-secondary-text, #333);
    border-color: var(--btn-secondary-border, #ccc);
}
.btn-secondary:hover {
    background: var(--btn-secondary-hover-bg, #e0e0e0);
}
</style>
{% endblock %}
