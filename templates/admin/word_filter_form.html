{% extends "container/public.html" %}

{% block title %}{% if filter.is_some() %}Edit{% else %}Add{% endif %} Word Filter - Admin{% endblock %}

{% block content %}
<div class="admin-panel">
    <div class="panel-header">
        <h1>{% if filter.is_some() %}Edit{% else %}Add{% endif %} Word Filter</h1>
        <p class="panel-subtitle">{% if filter.is_some() %}Modify an existing word filter{% else %}Create a new content filter or word replacement{% endif %}</p>
    </div>

    {% if let Some(err) = error %}
    <div class="alert alert-danger">{{ err }}</div>
    {% endif %}

    <form action="{% if let Some(f) = filter %}/admin/word-filters/{{ f.id }}{% else %}/admin/word-filters{% endif %}" method="post" class="filter-form">
        <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}" />

        <div class="form-group">
            <label for="pattern">Pattern</label>
            <input type="text" id="pattern" name="pattern"
                   value="{% if let Some(f) = filter %}{{ f.pattern }}{% endif %}"
                   placeholder="e.g., Solana" required />
            <small class="form-help">The word or pattern to match. Can be a regular expression if "Use regex" is checked.</small>
        </div>

        <div class="form-group">
            <label for="replacement">Replacement</label>
            <input type="text" id="replacement" name="replacement"
                   value="{% if let Some(f) = filter %}{% if let Some(r) = f.replacement.as_ref() %}{{ r }}{% endif %}{% endif %}"
                   placeholder="e.g., Salona" />
            <small class="form-help">What to replace the pattern with (only used for "Replace" action).</small>
        </div>

        <div class="form-group">
            <label for="action">Action</label>
            <select id="action" name="action" required>
                {% if let Some(f) = filter %}
                <option value="replace" {% if f.action.is_replace() %}selected{% endif %}>Replace - Substitute with replacement text</option>
                <option value="block" {% if f.action.is_block() %}selected{% endif %}>Block - Reject content entirely</option>
                <option value="flag" {% if f.action.is_flag() %}selected{% endif %}>Flag - Allow but flag for review</option>
                {% else %}
                <option value="replace" selected>Replace - Substitute with replacement text</option>
                <option value="block">Block - Reject content entirely</option>
                <option value="flag">Flag - Allow but flag for review</option>
                {% endif %}
            </select>
            <small class="form-help">What should happen when the pattern is matched.</small>
        </div>

        <div class="form-section">
            <h3>Matching Options</h3>

            {% if let Some(f) = filter %}
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_regex" id="is_regex"
                           {% if f.is_regex %}checked{% endif %} />
                    Use regular expression
                </label>
                <small class="form-help">Treat the pattern as a regex. Use with caution - invalid regex will fail.</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_case_sensitive" id="is_case_sensitive"
                           {% if f.is_case_sensitive %}checked{% endif %} />
                    Case sensitive
                </label>
                <small class="form-help">If unchecked, "Solana" will match "solana", "SOLANA", etc.</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_whole_word" id="is_whole_word"
                           {% if f.is_whole_word %}checked{% endif %} />
                    Match whole words only
                </label>
                <small class="form-help">If checked, "cat" won't match "category" or "scatter".</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_enabled" id="is_enabled"
                           {% if f.is_enabled %}checked{% endif %} />
                    Enabled
                </label>
                <small class="form-help">Disabled filters are not applied to content.</small>
            </div>
            {% else %}
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_regex" id="is_regex" />
                    Use regular expression
                </label>
                <small class="form-help">Treat the pattern as a regex. Use with caution - invalid regex will fail.</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_case_sensitive" id="is_case_sensitive" />
                    Case sensitive
                </label>
                <small class="form-help">If unchecked, "Solana" will match "solana", "SOLANA", etc.</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_whole_word" id="is_whole_word" checked />
                    Match whole words only
                </label>
                <small class="form-help">If checked, "cat" won't match "category" or "scatter".</small>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_enabled" id="is_enabled" checked />
                    Enabled
                </label>
                <small class="form-help">Disabled filters are not applied to content.</small>
            </div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="notes">Admin Notes (optional)</label>
            <textarea id="notes" name="notes" rows="2"
                      placeholder="Notes about why this filter exists">{% if let Some(f) = filter %}{% if let Some(n) = f.notes.as_ref() %}{{ n }}{% endif %}{% endif %}</textarea>
            <small class="form-help">Internal notes for administrators.</small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% if filter.is_some() %}Update{% else %}Create{% endif %} Filter</button>
            <a href="/admin/word-filters" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    <div class="help-section">
        <h3>Examples</h3>
        <table class="examples-table">
            <tr>
                <th>Use Case</th>
                <th>Pattern</th>
                <th>Replacement</th>
                <th>Action</th>
            </tr>
            <tr>
                <td>Word exchange</td>
                <td><code>Solana</code></td>
                <td><code>Salona</code></td>
                <td>Replace</td>
            </tr>
            <tr>
                <td>Censor profanity</td>
                <td><code>badword</code></td>
                <td><code>****</code></td>
                <td>Replace</td>
            </tr>
            <tr>
                <td>Block spam</td>
                <td><code>buy cheap pills</code></td>
                <td><em>n/a</em></td>
                <td>Block</td>
            </tr>
            <tr>
                <td>Flag for review</td>
                <td><code>competitor\.com</code> (regex)</td>
                <td><em>n/a</em></td>
                <td>Flag</td>
            </tr>
        </table>
    </div>
</div>

<style>
.admin-panel {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
}

.panel-header {
    margin-bottom: 30px;
}

.panel-header h1 {
    margin: 0 0 10px 0;
    color: #333;
}

.panel-subtitle {
    margin: 0;
    color: #666;
}

.alert {
    padding: 12px 16px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.filter-form {
    background: #fff;
    padding: 25px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

.form-section {
    margin: 25px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 6px;
}

.form-section h3 {
    margin: 0 0 15px 0;
    font-size: 1em;
    color: #333;
}

.form-group {
    margin-bottom: 20px;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #333;
}

.form-group input[type="text"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
}

.form-group textarea {
    resize: vertical;
}

.form-help {
    display: block;
    margin-top: 5px;
    color: #666;
    font-size: 0.85em;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: normal;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 25px;
}

.btn {
    display: inline-block;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    text-decoration: none;
}

.btn-primary {
    background: #007bff;
    color: #fff;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-secondary {
    background: #6c757d;
    color: #fff;
}

.btn-secondary:hover {
    background: #5a6268;
}

.help-section {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.help-section h3 {
    margin-top: 0;
    color: #333;
}

.examples-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
}

.examples-table th,
.examples-table td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.examples-table th {
    background: #e9ecef;
    font-weight: 600;
}

.examples-table code {
    background: #f4f4f4;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
}

/* Dark mode support */
html.dark .admin-panel h1,
html.dark .form-section h3,
html.dark .help-section h3 {
    color: #fff;
}

html.dark .panel-subtitle,
html.dark .form-help {
    color: #aaa;
}

html.dark .filter-form {
    background: #2a2a2a;
    border-color: #444;
}

html.dark .form-section,
html.dark .help-section {
    background: #333;
}

html.dark .form-group label {
    color: #fff;
}

html.dark .form-group input,
html.dark .form-group textarea,
html.dark .form-group select {
    background: #3a3a3a;
    border-color: #555;
    color: #fff;
}

html.dark .alert-danger {
    background: #3a2a2a;
    color: #ff6b6b;
    border-color: #5a3a3a;
}

html.dark .examples-table th {
    background: #444;
    color: #fff;
}

html.dark .examples-table td {
    border-color: #555;
}

html.dark .examples-table code {
    background: #444;
    color: #fff;
}
</style>
{% endblock %}
