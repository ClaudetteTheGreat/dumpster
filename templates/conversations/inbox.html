{% extends "container/public.html" %}

{% block content %}
<div class="thread">
    <div class="thread-header">
        <div class="thread-title-section">
            <h1>
                <span class="thread-badge thread-badge--private">Private</span>
                Messages
            </h1>
            <div class="thread-meta">
                {% if unread_count > 0 %}
                    <span class="unread-count">{{ unread_count }} unread</span>
                {% else %}
                    <span>No unread conversations</span>
                {% endif %}
            </div>
        </div>
        <div class="thread-actions">
            <a href="/conversations/archived" class="watch-button">Archived</a>
            <a href="/conversations/new" class="action-button">New Conversation</a>
        </div>
    </div>

    {% if conversations.is_empty() %}
        <div class="message">
            <div class="message-cell message-cell--main" style="text-align: center; padding: 40px;">
                <em>No conversations yet.</em>
                <p><a href="/conversations/new">Start one!</a></p>
            </div>
        </div>
    {% else %}
        {% for conv in conversations %}
        <a href="/conversations/{{ conv.id }}" class="conversation-row {% if conv.is_unread %}conversation-row--unread{% endif %}">
            <div class="conversation-row-main">
                <div class="conversation-title">
                    {% if let Some(title) = conv.title %}
                        {{ title }}
                    {% else %}
                        Conversation with {% for participant in conv.participants %}{{ participant }}{% if !loop.last %}, {% endif %}{% endfor %}
                    {% endif %}
                    {% if conv.is_unread %}
                        <span class="thread-badge thread-badge--new">NEW</span>
                    {% endif %}
                </div>
                <div class="conversation-participants">
                    With: {% for participant in conv.participants %}{{ participant }}{% if !loop.last %}, {% endif %}{% endfor %}
                </div>
            </div>
            <div class="conversation-row-meta">
                {% if let Some(preview) = conv.last_message_content %}
                    <div class="conversation-preview">{{ preview }}</div>
                {% endif %}
                {% if let Some(last_at) = conv.last_message_at %}
                    <time class="conversation-time">{{ last_at }}</time>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    {% endif %}
</div>

<style>
    .thread-badge--private {
        background: var(--bg-secondary, #f8f9fa);
        color: var(--text-color, #333);
        border: 1px solid var(--border-color, #dee2e6);
    }

    .thread-badge--new {
        background: #28a745;
        color: white;
        font-size: 0.7em;
        padding: 2px 8px;
        margin-left: 8px;
        vertical-align: middle;
    }

    .unread-count {
        color: #28a745;
        font-weight: 600;
    }

    .conversation-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: var(--bg-primary, #fff);
        border: 1px solid var(--border-color, #dee2e6);
        border-radius: 0;
        margin-bottom: -1px;
        text-decoration: none;
        color: inherit;
        transition: background 0.2s;
    }

    .conversation-row:first-of-type {
        border-radius: 8px 8px 0 0;
    }

    .conversation-row:last-of-type {
        border-radius: 0 0 8px 8px;
        margin-bottom: 0;
    }

    .conversation-row:only-of-type {
        border-radius: 8px;
    }

    .conversation-row:hover {
        background: var(--bg-hover, #f8f9fa);
    }

    .conversation-row--unread {
        background: var(--bg-unread, #f0f8ff);
        border-left: 4px solid #4a90e2;
    }

    html.dark .conversation-row--unread {
        background: var(--bg-unread-dark, #1a3a5c);
    }

    .conversation-row-main {
        flex: 1;
        min-width: 0;
    }

    .conversation-title {
        font-weight: 600;
        font-size: 1.05em;
        margin-bottom: 4px;
        color: var(--text-color, #333);
    }

    .conversation-participants {
        font-size: 0.9em;
        color: var(--text-muted, #666);
    }

    .conversation-row-meta {
        text-align: right;
        flex-shrink: 0;
        margin-left: 20px;
    }

    .conversation-preview {
        font-size: 0.9em;
        color: var(--text-secondary, #555);
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        margin-bottom: 4px;
    }

    .conversation-time {
        font-size: 0.85em;
        color: var(--text-muted, #999);
    }

    @media (max-width: 768px) {
        .conversation-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .conversation-row-meta {
            text-align: left;
            margin-left: 0;
            margin-top: 10px;
        }

        .conversation-preview {
            max-width: none;
        }
    }
</style>
{% endblock %}
