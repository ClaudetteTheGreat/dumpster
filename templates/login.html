{% extends "container/public.html" %}

{% block content %}
<h2>Login</h2>

{% if let Some(msg) = success_message %}
<div class="alert alert-success">
    {{ msg }}
</div>
{% endif %}
<form action="/login" method="post" aria-label="Login form">
    <input type="hidden" name="csrf_token" value="{{ client.get_csrf_token() }}">
    <div class="form-group">
        <label for="username" class="visually-hidden">Username</label>
        <input type="text" id="username" name="username" placeholder="username" aria-required="true" autocomplete="username">
    </div>
    <div class="form-group">
        <label for="password" class="visually-hidden">Password</label>
        <input type="password" id="password" name="password" placeholder="password" aria-required="true" autocomplete="current-password">
    </div>
    <div class="form-group">
        <label for="totp" class="visually-hidden">Two-factor authentication code (optional)</label>
        <input type="text" id="totp" name="totp" placeholder="2FA Code (optional)" autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]{6}">
    </div>
    <div class="form-group">
        <label>
            <input type="checkbox" id="remember_me" name="remember_me" value="true">
            Remember me for 30 days
        </label>
    </div>
    {% if captcha_required %}
    {% if let Some(provider) = captcha_provider %}
    {% if let Some(site_key) = captcha_site_key %}
    <div class="form-group">
        <p class="alert alert-warning">
            Due to multiple failed login attempts, please complete the CAPTCHA below.
        </p>
        {% if provider == "hcaptcha" %}
        <div class="h-captcha" data-sitekey="{{ site_key }}"></div>
        <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
        {% else if provider == "turnstile" %}
        <div class="cf-turnstile" data-sitekey="{{ site_key }}"></div>
        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
        {% endif %}
    </div>
    {% endif %}
    {% endif %}
    {% endif %}
    <button type="submit">Login</button>
</form>

<p><a href="/password-reset">Forgot your password?</a></p>

<div>
{% match user_id %}
    {% when Some with (user_id) %}
        Found {{ user_id }}
    {% when None %}
{% endmatch %}
</div>

<div>
{% match username %}
    {% when Some with (username) %}
        Found {{ username }}
    {% when None %}
{% endmatch %}
</div>

<div>
{% match token %}
    {% when Some with (token) %}
        Found {{ token }}
    {% when None %}
{% endmatch %}
</div>
{% endblock %}
